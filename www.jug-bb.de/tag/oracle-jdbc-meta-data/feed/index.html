<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:series="http://organizeseries.com/"
	>

<channel>
	<title>Java User Group Berlin Brandenburg &#187; Oracle JDBC Meta data</title>
	<atom:link href="http://www.jug-bb.de/tag/oracle-jdbc-meta-data/feed/" rel="self" type="application/rss+xml" />
	<link>http://www.jug-bb.de</link>
	<description>Der Blog der JUG-BB</description>
	<lastBuildDate>Sun, 29 Dec 2013 15:02:50 +0000</lastBuildDate>
	<language>de-DE</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.8.2</generator>
	<item>
		<title>JDBC Metadaten für Oracle stored procedures</title>
		<link>http://www.jug-bb.de/2010/04/jdbc-metadaten-fur-oracle-stored-procedures/</link>
		<comments>http://www.jug-bb.de/2010/04/jdbc-metadaten-fur-oracle-stored-procedures/#comments</comments>
		<pubDate>Mon, 05 Apr 2010 20:12:48 +0000</pubDate>
		<dc:creator><![CDATA[Jan Lolling]]></dc:creator>
				<category><![CDATA[Java]]></category>
		<category><![CDATA[Java Code Beispiele]]></category>
		<category><![CDATA[Oracle JDBC Meta data]]></category>

		<guid isPermaLink="false">http://www.jug-bb.de/?p=479</guid>
		<description><![CDATA[Das Konstrukt der Packages wird durch JDBC nicht wirklich gut unterstützt. JDBC geht leider auch von eindeutigen Namen für functions und procedures aus. Somit hat man ein Problem mit überladenen procedures. Diese unterscheiden sich nicht im Namen sondern in der Anzahl und Typen der Parameter. Der Oracle-JDBC-Treiber gibt alle Informationen raus, es erfordert nur etwas [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>Das Konstrukt der Packages wird durch JDBC nicht wirklich gut unterstützt. JDBC geht leider auch von eindeutigen Namen für functions und procedures aus. Somit hat man ein Problem mit überladenen procedures. Diese unterscheiden sich nicht im Namen sondern in der Anzahl und Typen der Parameter.<br />
Der Oracle-JDBC-Treiber gibt alle Informationen raus, es erfordert nur etwas Geschick diese Informationen einzusammeln.<br />
1. Die Name der packages werden als CATALOG ausgegeben.<br />
2. Die Parameter kennen ihren Index. Wenn ein Parameter für scheinbar die selbe procedure erscheint mit dem gleichen Index, dann ist das ein Zeichen für eine überladene procedure.</p>
<p>Der folgende Beispielcode geht davon aus, dass die procedures und functions in speziellen Objekten gehalten werden und die Parameter besitzen auch ihre eigene Transferklasse.</p>

<div class="wp_syntax"><table><tr><td class="code"><pre class="java" style="font-family:monospace;">	<span style="color: #008000; font-style: italic; font-weight: bold;">/**
	 * load procedure and functions
	 * 
	 * @param schema
	 *            object that represent a schema
	 * @return true if everything went well
	 */</span>
	<span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">boolean</span> loadProcedures<span style="color: #009900;">&#40;</span>SQLSchema schema<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>logger.<span style="color: #006633;">isDebugEnabled</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			logger.<span style="color: #006633;">debug</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;loadProcedures schema=&quot;</span> <span style="color: #339933;">+</span> schema<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #666666; font-style: italic;">// makes this thread save</span>
		inRefreshCycle <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #000066; font-weight: bold;">boolean</span> ok <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">// don' worry about that, we use our own database pool</span>
		<span style="color: #000000; font-weight: bold;">final</span> DatabaseSession session <span style="color: #339933;">=</span> DatabaseSessionPool.<span style="color: #006633;">getDatabaseSession</span><span style="color: #009900;">&#40;</span>cd.<span style="color: #006633;">getUniqueId</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>session <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// return if no connection to database avialable</span>
			<span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #003399;">Connection</span> conn <span style="color: #339933;">=</span> session.<span style="color: #006633;">getConnection</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #003399;">DatabaseMetaData</span> dbmd <span style="color: #339933;">=</span> conn.<span style="color: #006633;">getMetaData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			schema.<span style="color: #006633;">clearProcedures</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// remove any previously loaded procedures</span>
			<span style="color: #003399;">ResultSet</span> rs <span style="color: #339933;">=</span> dbmd.<span style="color: #006633;">getProcedures</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span>, schema.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>rs <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #666666; font-style: italic;">// loading all procedures and functions</span>
				<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span>rs.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #666666; font-style: italic;">// PROCEDURE_CAT contains the package name</span>
					<span style="color: #003399;">String</span> catalogName <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PROCEDURE_CAT&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #003399;">String</span> name <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PROCEDURE_NAME&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>catalogName <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;&amp;</span>amp<span style="color: #339933;">;</span> catalogName.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;</span>gt<span style="color: #339933;">;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						name <span style="color: #339933;">=</span> catalogName <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;.&quot;</span> <span style="color: #339933;">+</span> name<span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #666666; font-style: italic;">// create an new one</span>
					SQLProcedure procedure <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SQLProcedure<span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">this</span>, schema,	name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #666666; font-style: italic;">// decide if it is a function</span>
					<span style="color: #000066; font-weight: bold;">short</span> pType <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getShort</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PROCEDURE_TYPE&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					procedure.<span style="color: #006633;">setFunction</span><span style="color: #009900;">&#40;</span>pType <span style="color: #339933;">==</span> <span style="color: #003399;">DatabaseMetaData</span>.<span style="color: #006633;">procedureReturnsResult</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					schema.<span style="color: #006633;">addProcedure</span><span style="color: #009900;">&#40;</span>procedure<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					objectMap.<span style="color: #006633;">put</span><span style="color: #009900;">&#40;</span>name, procedure<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				rs.<span style="color: #006633;">close</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			<span style="color: #666666; font-style: italic;">// loading procedure/function parameters</span>
			rs <span style="color: #339933;">=</span> dbmd.<span style="color: #006633;">getProcedureColumns</span><span style="color: #009900;">&#40;</span><span style="color: #000066; font-weight: bold;">null</span>, schema.<span style="color: #006633;">getName</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>, <span style="color: #000066; font-weight: bold;">null</span>, <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>rs <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				<span style="color: #666666; font-style: italic;">// an index for overloaded procedures</span>
				<span style="color: #000066; font-weight: bold;">int</span> procedureIndex <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
				<span style="color: #003399;">String</span> prevProcedureName <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;noprocedurehere_xx&quot;</span><span style="color: #339933;">;</span>
				<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #009900;">&#40;</span>rs.<span style="color: #006633;">next</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
					<span style="color: #666666; font-style: italic;">// PROCEDURE_CAT contains the package name</span>
					<span style="color: #003399;">String</span> catalogName <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PROCEDURE_CAT&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #003399;">String</span> name <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PROCEDURE_NAME&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>catalogName <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;&amp;</span>amp<span style="color: #339933;">;</span> catalogName.<span style="color: #006633;">length</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;</span>gt<span style="color: #339933;">;</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						<span style="color: #666666; font-style: italic;">// add the catalog name as package name</span>
						name <span style="color: #339933;">=</span> catalogName <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot;.&quot;</span> <span style="color: #339933;">+</span> name<span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #000066; font-weight: bold;">int</span> pos <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
					<span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span>
						<span style="color: #666666; font-style: italic;">// position of this parameter in the procedure parameter</span>
						<span style="color: #666666; font-style: italic;">// list</span>
						pos <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getInt</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;ORDINAL_POSITION&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">Exception</span> e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						<span style="color: #666666; font-style: italic;">// perhaps this column is not defined in every database</span>
						<span style="color: #666666; font-style: italic;">// type</span>
						pos <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>prevProcedureName.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span>name<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>pos <span style="color: #339933;">==</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
							<span style="color: #666666; font-style: italic;">// if we get the same procedure name and a parameter</span>
							<span style="color: #666666; font-style: italic;">// with position zero increase the procedure index</span>
							<span style="color: #666666; font-style: italic;">// that means point to the next procedure with the</span>
							<span style="color: #666666; font-style: italic;">// same name</span>
							procedureIndex<span style="color: #339933;">++;</span>
						<span style="color: #009900;">&#125;</span>
					<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span>
						procedureIndex <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #003399;">String</span> columnName <span style="color: #339933;">=</span> rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;COLUMN_NAME&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #003399;">List</span> list <span style="color: #339933;">=</span> schema.<span style="color: #006633;">getProcedures</span><span style="color: #009900;">&#40;</span>name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					SQLProcedure procedure <span style="color: #339933;">=</span> list.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span>procedureIndex<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
					<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span>procedure <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
						procedure.<span style="color: #006633;">addParameter</span><span style="color: #009900;">&#40;</span>columnName, <span style="color: #666666; font-style: italic;">// parameter name</span>
								rs.<span style="color: #006633;">getShort</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;DATA_TYPE&quot;</span><span style="color: #009900;">&#41;</span>,  <span style="color: #666666; font-style: italic;">// parameter type as</span>
														   <span style="color: #666666; font-style: italic;">// integer defined</span>
														   <span style="color: #666666; font-style: italic;">// in class</span>
														   <span style="color: #666666; font-style: italic;">// java.sql.Type</span>
								rs.<span style="color: #006633;">getString</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;TYPE_NAME&quot;</span><span style="color: #009900;">&#41;</span>, <span style="color: #666666; font-style: italic;">// parameter type as</span>
														   <span style="color: #666666; font-style: italic;">// string</span>
								rs.<span style="color: #006633;">getInt</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;LENGTH&quot;</span><span style="color: #009900;">&#41;</span>,    <span style="color: #666666; font-style: italic;">// length of the parameter</span>
														<span style="color: #666666; font-style: italic;">// if parameter is</span>
														<span style="color: #666666; font-style: italic;">// string or number type</span>
								rs.<span style="color: #006633;">getInt</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;PRECISION&quot;</span><span style="color: #009900;">&#41;</span>, <span style="color: #666666; font-style: italic;">// precision of the</span>
														<span style="color: #666666; font-style: italic;">// parameter if the</span>
														<span style="color: #666666; font-style: italic;">// parameter is a number</span>
														<span style="color: #666666; font-style: italic;">// type</span>
								rs.<span style="color: #006633;">getShort</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;COLUMN_TYPE&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// input or output</span>
														     <span style="color: #666666; font-style: italic;">// parameter as</span>
														     <span style="color: #666666; font-style: italic;">// integer:</span>
															 <span style="color: #666666; font-style: italic;">// refer</span>
															 <span style="color: #666666; font-style: italic;">// DatabaseMetaData.procedureColumnReturn</span>
					<span style="color: #009900;">&#125;</span>
					<span style="color: #666666; font-style: italic;">// keep the name of the last procedure to detect overloaded</span>
					<span style="color: #666666; font-style: italic;">// procedures</span>
					prevProcedureName <span style="color: #339933;">=</span> name<span style="color: #339933;">;</span>
				<span style="color: #009900;">&#125;</span>
				rs.<span style="color: #006633;">close</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>
			schema.<span style="color: #006633;">setProcedureLoaded</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			ok <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">true</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span><span style="color: #003399;">SQLException</span> sqle<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// creates a error message to show it in GUI</span>
			errorMessage <span style="color: #339933;">=</span> <span style="color: #0000ff;">&quot;loadProcedures schema=&quot;</span> <span style="color: #339933;">+</span> schema <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; failed: &quot;</span>
					<span style="color: #339933;">+</span> sqle.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">finally</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #666666; font-style: italic;">// put the session back in the pool</span>
			DatabaseSessionPool.<span style="color: #006633;">release</span><span style="color: #009900;">&#40;</span>session<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		inRefreshCycle <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">false</span><span style="color: #339933;">;</span>
		<span style="color: #000000; font-weight: bold;">return</span> ok<span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span></pre></td></tr></table></div>

]]></content:encoded>
			<wfw:commentRss>http://www.jug-bb.de/2010/04/jdbc-metadaten-fur-oracle-stored-procedures/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
	</channel>
</rss>
